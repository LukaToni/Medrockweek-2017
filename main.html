<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<title>DOCTOR - Responsive HTML &amp; Bootstrap Template</title>
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/style.css">
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:600italic,400,800,700,300' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=BenchNine:300,400,700' rel='stylesheet' type='text/css'>
	<script src="js/modernizr.js"></script>
	<!--[if lt IE 9]>
	<script src="js/html5shiv.js"></script>
	<script src="js/respond.min.js"></script>
	<![endif]-->

	<!-- d3.js -->
	<script src="https://d3js.org/d3.v4.min.js"></script>

	<!-- chart loader from google -->
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

	<!-- email -->
	<script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
	<script type="text/javascript">
        (function(){
            emailjs.init("user_HeEzoo4CZlxk95qHMu70N");
        })();

	</script>

</head>
<body>

	<!-- ====================================================
	header section -->
	<header class="top-header">
		<div class="container">
			<div class="row">
				<div class="col-xs-5 header-logo">
					<img src="img/logo.png" alt="" class="img-responsive logo" style="width: 223px;">
				</div>

				<div class="col-md-7">
					<nav class="navbar navbar-default">
					  <div class="container-fluid nav-bar">
					    <!-- Brand and toggle get grouped for better mobile display -->
					    <div class="navbar-header">
					      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					        <span class="sr-only">Toggle navigation</span>
					        <span class="icon-bar"></span>
					        <span class="icon-bar"></span>
					        <span class="icon-bar"></span>
					      </button>
					    </div>

					    <!-- Collect the nav links, forms, and other content for toggling -->
					    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

					      <ul class="nav navbar-nav navbar-right" style="width: 700px">
					        <li><a class="menu active" href="#home" >Home</a></li>
					        <li><a class="menu" href="#about">about us</a></li>
					        <li><a class="menu" href="#service">our services </a></li>
					        <li><a class="menu" href="#team">our team</a></li>
					        <li><a class="menu" href="#contact"> contact us</a></li>
						  	<li><a class="menu" href="index.html"> logout</a></li>
					      </ul>
					    </div><!-- /navbar-collapse -->
					  </div><!-- / .container-fluid -->
					</nav>
				</div>
			</div>
		</div>
	</header> <!-- end of header area -->

	<section class="slider" id="home">
		<div class="container-fluid">
			<div class="row">
			    <div id="carouselHacked" class="carousel slide carousel-fade" data-ride="carousel">
					<div class="header-backup"></div>
			        <!-- Wrapper for slides -->
			        <div class="carousel-inner" role="listbox">
			            <div class="item active">
			            	<img src="img/slide-one.jpg" alt="">
			                <div class="carousel-caption">
		               			<h1>providing</h1>
		               			<p>highquality service for men &amp; women</p>
		               			<button>learn more</button>
			                </div>
			            </div>
			            <div class="item">
			            	<img src="img/slide-two.jpg" alt="">
			                <div class="carousel-caption">
		               			<h1>providing</h1>
		               			<p>highquality service for men &amp; women</p>
		               			<button>learn more</button>
			                </div>
			            </div>
			            <div class="item">
			            	<img src="img/slide-three.jpg" alt="">
			                <div class="carousel-caption">
		               			<h1>providing</h1>
		               			<p>highquality service for men &amp; women</p>
		               			<button>learn more</button>
			                </div>
			            </div>
			            <div class="item">
			            	<img src="img/slide-four.jpg" alt="">
			                <div class="carousel-caption">
		               			<h1>providing</h1>
		               			<p>highquality service for men &amp; women</p>
		               			<button>learn more</button>
			                </div>
			            </div>
			        </div>
			        <!-- Controls -->
			        <a class="left carousel-control" href="#carouselHacked" role="button" data-slide="prev">
			            <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
			            <span class="sr-only">Previous</span>
			        </a>
			        <a class="right carousel-control" href="#carouselHacked" role="button" data-slide="next">
			            <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
			            <span class="sr-only">Next</span>
			        </a>
			    </div>
			</div>
		</div>
	</section><!-- end of slider section -->

	<!-- about section -->
	<section class="about text-center" id="about">
		<div class="container">
			<div class="row">
				<br/><br/><br/>
				<h2>about us</h2>
				<!--<div id="header"></div>-->
				<!--<div id="result"></div>-->
				<!--<h2 id="ehrid"></h2>-->

				<table class="table" style="background: white">
					<thead>
					<tr>
						<th class="col-xs-1 col-sm-1 col-md-1 col-lg-1">Temperature [°C]</th>
						<th class="col-xs-1 col-sm-1 col-md-1 col-lg-1">Systolic [mm[Hg]]</th>
						<th class="col-xs-1 col-sm-1 col-md-1 col-lg-1">Diastolic [mm[Hg]]</th>
						<th class="col-xs-1 col-sm-1 col-md-1 col-lg-1">Weight [kg]</th>
						<th class="col-xs-1 col-sm-1 col-md-1 col-lg-1">Pulse [/min]</th>
					</tr>
					</thead>
					<tbody>
					<tr>
						<th class="col-xs-1 col-sm-1 col-md-1 col-lg-1" id="temperature_result" ></th>
						<td class="col-xs-1 col-sm-1 col-md-1 col-lg-1" id="blood_pressure_result_systolic"></td>
						<td class="col-xs-1 col-sm-1 col-md-1 col-lg-1" id="blood_pressure_result_diastolic"></td>
						<td class="col-xs-1 col-sm-1 col-md-1 col-lg-1" id="weight_result"></td>
						<td class="col-xs-1 col-sm-1 col-md-1 col-lg-1" id="pulse_result"></td>
					</tr>
					</tbody>
				</table>
				<!-- Graphs -->
				<div style="float: left; text-align: center;">
					<h2 style="font-size: 40px;">Temperature graph</h2>
					<div id="Temparature_Graph" style="width: 560px; height: 500px; margin-right: 50px;"></div>
				</div>
				<div style="float: left; text-align: center;">
					<h2 style="font-size: 40px">Blood pressure graph</h2>
					<div id="BloodPressure_Graph" style="width: 560px; height: 500px;"></div>
				</div>

				<div style="float: left; text-align: center;">
					<h2 style="font-size: 40px;">Weight graph</h2>
					<div id="Weight_Graph" style="width: 560px; height: 500px; margin-right: 50px;"></div>
				</div>
				<div style="float: left; text-align: center;">
					<h2 style="font-size: 40px">Pulse graph</h2>
					<div id="Pulse_Graph" style="width: 560px; height: 500px;"></div>
                </div>
                
                <div style="float: left; text-align: center;">
                    <label><h2>Daily Pulse graph</h2></label>
                    <div id="Daily_Pulse" style="width: 700px; height: 500px;"></div>
                </div>
                <div style="float: left; text-align: center;">
                    <label><h2>Daily Blood Pressure graph</h2></label>
                    <div id="Daily_BP" style="width: 700px; height: 500px;"></div>
                </div>

                <div style="float: left; text-align: center;">
                    <h2>Weekly Pulse graph</h2>
                    <div id="Weekly_Pulse" style="width: 700px; height: 500px;"></div>
                </div>
                <div style="float: right; text-align: center;">
                    <h2>Weekly Blood Pressure graph</h2>
                    <div id="Weekly_BP" style="width: 700px; height: 500px;"></div>
                </div>

                <div style="float: left; text-align: center;">
                    <h2>Monthly Pulse graph</h2>
                    <div id="Monthly_Pulse" style="width: 700px; height: 500px;"></div>
                </div>
                <div style="float: right; text-align: center;">
                    <h2>Monthly Blood Pressure graph</h2>
                    <div id="Monthly_BP" style="width: 700px; height: 500px;"></div>
                </div>

			</div>
		</div>
	</section><!-- end of about section -->


	<!-- service section starts here -->
	<section class="service text-center" id="service">
		<div class="container">
			<div class="row">
				<h2>our services</h2><br/><br/><br/><br/>
				<h4>Lorem Ipsum has been the industry's standard dummy text ever since the 1500s</h4>
				<div class="col-md-3 col-sm-6">
					<div class="single-service">
						<div class="single-service-img">
							<div class="service-img">
								<img class="heart img-responsive" src="img/service1.png" alt="">
							</div>
						</div>

						<h3>Heart problem</h3>
					</div>
				</div>
				<div class="col-md-3 col-sm-6">
					<div class="single-service">
						<div class="single-service-img">
							<div class="service-img">
								<img class="brain img-responsive" src="img/service2.png" alt="">
							</div>
						</div>
						<h3>brain problem</h3>
					</div>
				</div>
				<div class="col-md-3 col-sm-6">
					<div class="single-service">
						<div class="single-service-img">
							<div class="service-img">
								<img class="knee img-responsive" src="img/service3.png" alt="">
							</div>
						</div>
						<h3>knee problem</h3>
					</div>
				</div>
				<div class="col-md-3 col-sm-6">
					<div class="single-service">
						<div class="single-service-img">
							<div class="service-img">
								<img class="bone img-responsive" src="img/service4.png" alt="">
							</div>
						</div>
						<h3>human bones problem</h3>
					</div>
				</div>
			</div>
		</div>
	</section><!-- end of service section -->


	<!-- team section -->
	<section class="team" id="team">
		<div class="container">
			<div class="row">
				<div class="team-heading text-center">
					<h2>our team</h2><br/><br/>
				</div>
				<div class="col-md-2 single-member col-sm-4">
					<div class="person">
						<img class="img-responsive" src="img/member1.jpg" alt="member-1">
					</div>
					<div class="person-detail">
						<div class="arrow-bottom"></div>
						<h3>Dr. M. Weiner, M.D.</h3>
						<p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, </p>
					</div>
				</div>
				<div class="col-md-2 single-member col-sm-4">
					<div class="person-detail">
						<div class="arrow-top"></div>
						<h3>Dr. Danielle, M.D.</h3>
						<p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, </p>
					</div>
					<div class="person">
						<img class="img-responsive" src="img/member2.jpg" alt="member-2">
					</div>
				</div>
				<div class="col-md-2 single-member col-sm-4">
					<div class="person">
						<img class="img-responsive" src="img/member3.jpg" alt="member-3">
					</div>
					<div class="person-detail">
						<div class="arrow-bottom"></div>
						<h3>Dr. Caitlin, M.D.</h3>
						<p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, </p>
					</div>
				</div>
				<div class="col-md-2 single-member col-sm-4">
					<div class="person-detail">
						<div class="arrow-top"></div>
						<h3>Dr. Joseph, M.D.</h3>
						<p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, </p>
					</div>
					<div class="person">
						<img class="img-responsive" src="img/member4.jpg" alt="member-4">
					</div>
				</div>
				<div class="col-md-2 single-member col-sm-4">
					<div class="person">
						<img class="img-responsive" src="img/member5.jpg" alt="member-5">
					</div>
					<div class="person-detail">
						<div class="arrow-bottom"></div>
						<h3>Dr. Michael, M.D.</h3>
						<p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, </p>
					</div>
				</div>
				<div class="col-md-2 single-member col-sm-4">
					<div class="person-detail">
						<div class="arrow-top"></div>
						<h3>Dr. Hasina, M.D.</h3>
						<p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, </p>
					</div>
					<div class="person">
						<img class="img-responsive" src="img/member6.jpg" alt="member-5">
					</div>
				</div>
			</div>
		</div>
	</section><!-- end of team section -->

	<!-- map section -->
	<div class="api-map" id="contact">
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-12 map" id="map"></div>
			</div>
		</div>
	</div><!-- end of map section -->

	<!-- contact section starts here -->
	<section class="contact">
		<div class="container">
			<div class="row">
				<div class="contact-caption clearfix">
					<div class="contact-heading text-center">
						<h2>contact us</h2>
					</div>
					<div class="col-md-5 contact-info text-left">
						<h3>contact information</h3>
						<div class="info-detail">
							<ul><li><i class="fa fa-calendar"></i><span>Monday - Friday:</span> 9:30 AM to 6:30 PM</li></ul>
							<ul><li><i class="fa fa-map-marker"></i><span>Address:</span> 123 Some Street , London, UK, CP 123</li></ul>
							<ul><li><i class="fa fa-phone"></i><span>Phone:</span> (032) 987-1235</li></ul>
							<ul><li><i class="fa fa-fax"></i><span>Fax:</span> (123) 984-1234</li></ul>
							<ul><li><i class="fa fa-envelope"></i><span>Email:</span> info@doctor.com</li></ul>
						</div>
					</div>
					<div class="col-md-6 col-md-offset-1 contact-form">
						<h3>leave us a message</h3>

						<form class="form">
							<input class="name" type="text" placeholder="Name">
							<input class="email" type="email" placeholder="Email">
							<input class="phone" type="text" placeholder="Phone No:">
							<textarea class="message" name="message" id="message" cols="30" rows="10" placeholder="Message"></textarea>
							<input class="submit-btn" type="submit" value="SUBMIT">
						</form>
					</div>
				</div>
			</div>
		</div>
	</section><!-- end of contact section -->

	<!-- footer starts here -->
	<footer class="footer clearfix">
		<div class="container">
			<div class="row">
				<div class="col-xs-6 footer-para" style="text-align: center">
					<p>&copy;lukatoni All right reserved</p>
				</div>
				<div class="col-xs-6 text-right">
					<a href="https://facebook.com/warnadoc"><i class="fa fa-facebook"></i></a>
					<a href="https://twitter.com/warnadoc"><i class="fa fa-twitter"></i></a>
					<a href=""><i class="fa fa-skype"></i></a>
				</div>
			</div>
		</div>
	</footer>

	<!-- script tags
	============================================================= -->
	<script src="js/jquery-2.1.1.js"></script>
	<script src="http://maps.google.com/maps/api/js?sensor=true"></script>
	<script src="js/gmaps.js"></script>
	<script src="js/smoothscroll.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/custom.js"></script>
</body>
</html>


<script>
    var url = 'https://ql-demo.marand.si/data?size=15';

    /**
     * Get page form url
     *
     * @param url
     * @returns {string}
     * @constructor
     */
    function Get(url){
        var Httpreq = new XMLHttpRequest(); // a new request
        Httpreq.open("GET", url, false);
        Httpreq.send(null);
        return Httpreq.responseText;
    }

    var json_obj = JSON.parse(Get(url));
    //console.log("this is the author name: "+json_obj);



    //var ehrId = "820004f5-0173-4877-9604-e92ace0a3af5";
    var ehrId = "50e1f335-9f17-4d0e-8a2c-c396cb3869a9";

    var baseUrl = 'https://rest.ehrscape.com/rest/v1';
    var queryUrl = baseUrl + '/query';
    var username = 'medrock2017';
    var password = 'medrock2017';
    var authorization = "Basic " + btoa(username + ":" + password);


    var i;
    var systolic_value,
        diastolic_value,
        pressure_middle_value,
        weight_value,
        temperature_body_value,
        temperature_ambient_value,
        pulse_rate_value,
        measurement_time;
    for (i = 0; i < 3; ++i) {

        try {
			/* UPPER PRESSURE value 140*/
            systolic_value = json_obj.hits[i]._source.qcl_json_data.records[0].systolic.value;
        } catch(err) {
            //
        }

        try {
			/* DIASTOLIC value 80*/
            diastolic_value = json_obj.hits[i]._source.qcl_json_data.records[0].diastolic.value;
        } catch(err) {
            //
        }

        try {
			/* MIDDLE PRESSURE value 100*/
            pressure_middle_value = json_obj.hits[i]._source.qcl_json_data.records[0].meanArterialPressure.value;
        } catch(err) {
            //
        }

        try {
			/* WEIGHT*/
            weight_value = json_obj.hits[i]._source.qcl_json_data.records[0].weight.value;
        } catch(err) {
            //
        }

        try {
            temperature_body_value = json_obj.hits[i]._source.qcl_json_data.records[0].temperatureBody.value;
        } catch(err) {
            //
        }

        try {
            temperature_ambient_value = json_obj.hits[i]._source.qcl_json_data.records[0].temperatureAmbient.value;
        } catch(err) {
            //
        }

        try {
            pulse_rate_value = json_obj.hits[i]._source.qcl_json_data.records[0].pulseRate.value;
        } catch(err) {
            //
        }

        try {
            measurement_time = json_obj.hits[i]._source.qcl_json_data.deviceDetails.measurementTime.value.toDateString();
        } catch(err) {
            //
        }
        // windows.$json.hits[0].sourcce.qcl_json_data.deviceDetails.measurementTime.value
    }

	/* POST DATA TO EHR */
    var compositionData = {
        "ctx/time": measurement_time,
        "ctx/language": "en",
        "ctx/territory": "CA",
        "vital_signs/body_temperature/any_event/temperature|magnitude": temperature_body_value,
        "vital_signs/body_temperature/any_event/temperature|unit": "°C",
        "vital_signs/blood_pressure/any_event/systolic": systolic_value,
        "vital_signs/blood_pressure/any_event/diastolic": diastolic_value,
        "vital_signs/body_weight/any_event/body_weight": weight_value,
        "vital_signs/pulse:0/any_event:0/rate|magnitude": pulse_rate_value,
        "vital_signs/pulse:0/any_event:0/rate|unit": "/min"
    };

    var queryParams = {
        "ehrId": ehrId,
        templateId: 'Vital Signs',
        format: 'FLAT',
        committer: 'Belinda Nurse'
    };

    $.ajaxSetup({
        headers: {
            "Authorization": authorization
        }
    });


	/* EHRID */
    $("#ehrid").append( ehrId );

	/* TEMPERATURE */
    $.ajax({
        url: baseUrl + "/composition?" + $.param(queryParams),
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(compositionData),
        success: function (res) {
            $("#header").html("Store composition");
            $("#result").html(res.meta.href);
            console.log("success");
        }
    });

    // POST DATA TO THER

	/*$.ajaxSetup({
	 headers: {
	 "Authorization": authorization
	 }
	 });
	 $.ajax({
	 url: baseUrl + "/ehr",
	 type: 'POST',
	 success: function (data) {
	 var ehrId = data.ehrId;
	 $("#header").html("EHR: " + ehrId);

	 // build party data
	 var partyData = {
	 firstNames: "Edo",
	 lastNames: "Lj",
	 dateOfBirth: "1994-7-18T19:30",
	 partyAdditionalInfo: [
	 {
	 key: "ehrId",
	 value: ehrId
	 }
	 ]
	 };
	 $.ajax({
	 url: baseUrl + "/demographics/party",
	 type: 'POST',
	 contentType: 'application/json',
	 data: JSON.stringify(partyData),
	 success: function (party) {
	 if (party.action == 'CREATE') {
	 $("#result").html("Created: " + party.meta.href);
	 }
	 }
	 });
	 }
	 });*/

	/* READ DATA FROM EHR */
    $.ajax({
        url: baseUrl + "/view/" + ehrId + "/body_temperature",
        type: 'GET',
        headers: {
            "Authorization": authorization
        },
        success: function (res) {
            $("#temperature").append("Body Temperatures");
            var body_temperature_array = [];
            for (var i in res) {
                $("#temperature_result").append(res[i].temperature + "</br>");
                body_temperature_array.push(res[i].temperature);
            }

            drawGraphBT(body_temperature_array);
        }
    });

	/* BLOOD */
    $.ajax({
        url: baseUrl + "/view/" + ehrId + "/blood_pressure",
        type: 'GET',
        headers: {
            "Authorization": authorization
        },
        success: function (res) {
            var systolic_array = [];
            var diastolic_array = [];
            for (var i in res) {
                $("#blood_pressure_result_systolic").append( res[i].systolic + "</br>");
                $("#blood_pressure_result_diastolic").append(res[i].diastolic + "</br>");
                systolic_array.push(res[i].systolic);
                diastolic_array.push(res[i].diastolic);
            }

            drawGraphBP(systolic_array, diastolic_array);
        }
    });

	/* WEIGHT */
    $.ajax({
        url: baseUrl + "/view/" + ehrId + "/weight",
        type: 'GET',
        headers: {
            "Authorization": authorization
        },
        success: function (res) {
            var weight_array = [];
            for (var i in res) {
                $("#weight_result").append(res[i].weight + "</br>");
                weight_array.push(res[i].weight);
            }

            drawGraphW(weight_array);
        }
    });

	/* PULSE */
    $.ajax({
        url: baseUrl + "/view/" + ehrId + "/pulse",
        type: 'GET',
        headers: {
            "Authorization": authorization
        },
        success: function (res) {
            var pulse_array = [];
            for (var i in res) {
                $("#pulse_result").append(res[i].pulse + "</br>");
                pulse_array.push(res[i].pulse);
            }

            drawGraphP(pulse_array);
        }
    });

    function drawGraphBT(body_temperature_array) {
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChartBT);

        function drawChartBT() {
            var data = new google.visualization.DataTable();
            data.addColumn("string", "year");
            data.addColumn('number', 'temparature');

            for(i = 0; i < body_temperature_array.length; i++) {
                data.addRow(["2011", Number(body_temperature_array[i])]);
            }
            // Create and draw the visualization.
            var options = {
                title: 'Body temparature',
                curveType: 'function',
                legend: { position: 'bottom' }
            };
            var chart = new google.visualization.LineChart(document.getElementById('Temparature_Graph'));

            chart.draw(data, options);
        }
    }

    function drawGraphBP(systolic_array, diastolic_array) {
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChartBP);

        function drawChartBP() {
            var data = new google.visualization.DataTable();
            data.addColumn("string", "year");
            data.addColumn('number', 'diastolic');
            data.addColumn('number', 'systolic');

            for(i = 0; i < diastolic_array.length; i++) {
                data.addRow(["2011", Number(diastolic_array[i]), Number(systolic_array[i])]);
            }
            // Create and draw the visualization.
            var options = {
                title: 'Blood Pressure',
                curveType: 'function',
                legend: { position: 'bottom' }
            };
            var chart = new google.visualization.LineChart(document.getElementById('BloodPressure_Graph'));

            chart.draw(data, options);
        }
    }

    function drawGraphW(weight_array) {
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChartW);

        function drawChartW() {
            var data = new google.visualization.DataTable();
            data.addColumn("string", "year");
            data.addColumn('number', 'weight');

            for(i = 0; i < weight_array.length; i++) {
                data.addRow(["2011", Number(weight_array[i])]);
            }
            // Create and draw the visualization.
            var options = {
                title: 'Weight',
                curveType: 'function',
                legend: { position: 'bottom' }
            };
            var chart = new google.visualization.LineChart(document.getElementById('Weight_Graph'));

            chart.draw(data, options);
        }
    }

    function drawGraphP(pulse_array) {
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChartP);

        function drawChartP() {
            var data = new google.visualization.DataTable();
            data.addColumn("string", "year");
            data.addColumn('number', 'pulse');

            for(i = 0; i < pulse_array.length; i++) {
                data.addRow(["2011", Number(pulse_array[i])]);
            }
            // Create and draw the visualization.
            var options = {
                title: 'Pulse',
                curveType: 'function',
                legend: { position: 'bottom' }
            };
            var chart = new google.visualization.LineChart(document.getElementById('Pulse_Graph'));

            chart.draw(data, options);
        }
    }

	/*read data from JSON */
    var url_dia = 'diastolic.json';
    var url_sys = 'systolic.json';
    var url_pulse = 'pulse.json';
    var url_temp = 'Temperature.json';

    var json_object_dia = JSON.parse(Get(url_dia));
    var json_object_sys = JSON.parse(Get(url_sys));
    var json_object_pulse = JSON.parse(Get(url_pulse));
    var json_object_temp = JSON.parse(Get(url_temp));

    var json_object_dia_len = Object.keys(json_object_dia).length;
    var json_object_sys_len = Object.keys(json_object_sys).length;
    var json_object_pulse_len = Object.keys(json_object_pulse).length;
    var json_object_temp_len = Object.keys(json_object_temp).length;

    var systolic_val = new Array(json_object_sys_len);
    var diastolic_val = new Array(json_object_dia_len);
    var temperature_body_val = new Array(json_object_pulse_len);
    var pulse_rate_val = new Array(json_object_temp_len);

    function getDataFromJSON(length) {
        for (i = 0; i < length; ++i) {
            try {
                systolic_val[i] = json_object_sys[i][0];
            } catch(err) {
                //console.log("catch")
            }
            try {
                diastolic_val[i] = json_object_dia[i][0];
            } catch(err) {
                //console.log("catch")
            }
            try {
                temperature_body_val[i] = json_object_temp[i][0];
            } catch(err) {
                //console.log("catch")
            }
            try {
                pulse_rate_val[i] = json_object_pulse[i][0];
            } catch(err) {
                //console.log("catch")
            }
        }
    }

    getDataFromJSON(json_object_sys_len);
    getDataFromJSON(json_object_dia_len);
    getDataFromJSON(json_object_pulse_len);
    getDataFromJSON(json_object_temp_len);

    var high = 0;
    var low = 0;
    var normal = 0;

    // DAILY STATISTICS
    // SYS: 90, 90, 140
    // DIA: 60, 60, 90
    // temp: 35.8, 35.8, 37.2
    // pulse: 60,60,100

    function getDailyStatistics(array, lower_limit, high_limit) {
        var days = new Array(array.length);
        for(var i=0; i < array.length; i++) {
            low = 0;
            high = 0;
            normal = 0;
            for(var j=0; j < 3; j++) {
                var a = array[i];
                if (a <= lower_limit) {
                    low++;
                } else if (lower_limit < a && a < high_limit) {
                    normal++;
                } else {
                    high++;
                }
            }
            days[i] = [];
            days[i][0] = low;
            days[i][1] = normal;
            days[i][2] = high;
        }
        return days;
    }


    var dailySys = getDailyStatistics(systolic_val, 90, 140);
    var dailyDis = getDailyStatistics(diastolic_val, 60, 90);
    var dailyPulse = getDailyStatistics(pulse_rate_val, 60, 100);
    var dailyTemp = getDailyStatistics(temperature_body_val, 35.8, 37.2);

    function getDailyPercentage(dailyData) {
        var dailyStats = new Array(dailyData.length);

        for(var i = 0; i < dailyStats.length; ++i) {
            dailyStats[i] = new Array(2);
            if (dailyData[i][0] === 0) {
                dailyStats[i][0] = 0;
            }
            if (dailyData[i][0] === 1) {
                dailyStats[i][0] = 1/3*100;
            }
            if (dailyData[i][0] === 2) {
                dailyStats[i][0] = 2/3*100;
            }
            if (dailyData[i][0] === 3) {
                dailyStats[i][0] = 100;
            }
            if (dailyData[i][1] === 0) {
                dailyStats[i][1] = 0;
            }
            if (dailyData[i][1] === 1) {
                dailyStats[i][1] = 1/3*100;
            }
            if (dailyData[i][1] === 2) {
                dailyStats[i][1] = 2/3*100;
            }
            if (dailyData[i][1] === 3) {
                dailyStats[i][1] = 100;
            }
            if (dailyData[i][2] === 0) {
                dailyStats[i][2] = 0;
            }
            if (dailyData[i][2] === 1) {
                dailyStats[i][2] = 1/3*100;
            }
            if (dailyData[i][2] === 2) {
                dailyStats[i][2] = 2/3*100;
            }
            if (dailyData[i][2] === 3) {
                dailyStats[i][2] = 100;
            }
        }
        return dailyStats;
    }

    // daily data
    var percentageDaySys = getDailyPercentage(dailySys);
    var percentageDayDia = getDailyPercentage(dailyDis);
    var percentageDayPulse = getDailyPercentage(dailyPulse);

        // initialization of google charts
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChartDailyPulse);
    google.charts.setOnLoadCallback(drawChartDailyBP);

    function drawChartDailyPulse() {
        var data = google.visualization.arrayToDataTable([
          ['Pulse', 'Procentage'],
          ['Low', percentageDayPulse[0][0]],
          ['Normal', percentageDayPulse[0][1]],
          ['High', percentageDayPulse[0][2]]
        ]);    

        var options = {
          title: 'Daily Data for Pulse',
        };

        var chart = new google.visualization.PieChart(document.getElementById('Daily_Pulse'));

        chart.draw(data, options);
    }

    function drawChartDailyBP() {

        var l = 0, n = 0, h = 0;
        for(var i=0; i < 3; i++) {
            if(systolic_val[0][i] < 90 && diastolic_val[0][i] < 60) {
                // low 
                l++;  
            } else if(systolic_val[0][i] > 140 && diastolic_val[0][i] > 90) {
                // high
                h++;
            } else {
                n++;
            }    
        }

        var data = google.visualization.arrayToDataTable([
          ['Pulse', 'Procentage'],
          ['Low', l*100/3],
          ['Normal', n*100/3],
          ['High', h*100/3]
        ]);      

        var options = {
          title: 'Daily Data for Blood Pressure',
        };

        var chart = new google.visualization.PieChart(document.getElementById('Daily_BP'));

        chart.draw(data, options);
    }

    // WEEKLY STATISTICS
    var normal = 0;
    var lower = 0;
    var higher = 0;

    function getWeeklyStats(dailyData) {
        var weeklyStats = new Array(2);
        lower = 0;
        normal = 0;
        higher = 0;
        var stevec = 0;
        var st = 0;

        for(var i = 0; i < dailyData.length; i+=7) {
            lower=0;
            normal=0;
            higher=0;
            if (stevec === 7) {
                break;
            }
            for(var j=0; j < 7; j++) {
                normal += dailyData[i+j][1];
                lower += dailyData[i+j][0];
                higher += dailyData[i+j][2];

            }
            stevec++;
            weeklyStats[st] = new Array(2);
            weeklyStats[st][0] = lower/21;
            weeklyStats[st][1] = normal/21;
            weeklyStats[st][2] = higher/21;
            st++;
        }

        return weeklyStats;
    }

    // data for graphs
    var weeklySys = getWeeklyStats(dailySys);
    var weeklyDia = getWeeklyStats(dailyDis);
    var weeklyPulse = getWeeklyStats(dailyPulse);
    var weeklyTemperature = getWeeklyStats(dailyTemp);

    // calls for graphs
    google.charts.setOnLoadCallback(drawChartWeekPulse);
    google.charts.setOnLoadCallback(drawChartWeekBP);
    google.charts.setOnLoadCallback(drawChartMonthPulse);
    google.charts.setOnLoadCallback(drawChartMonthBP);

    function drawChartWeekPulse() {
        var data = google.visualization.arrayToDataTable([
          ['Pulse', 'Procentage'],
          ['Low', weeklyPulse[0][0]],
          ['Normal', weeklyPulse[0][1]],
          ['High', weeklyPulse[0][2]]
        ]);    

        var options = {
          title: 'Weekly Data for Pulse',
        };

        var chart = new google.visualization.PieChart(document.getElementById('Weekly_Pulse'));

        chart.draw(data, options);
    }

    function drawChartWeekBP() {
        var l = 0, n = 0, h = 0;
        for(var i = 0; i < 21; i++) { 
            if(systolic_val[i] < 90 && diastolic_val[i] < 60) {
                // low 
                l++;  
            } else if(systolic_val[i] > 140 && diastolic_val[i] > 90) {
                // high
                h++;
            } else {
                n++;
            }  
        }   

        var data = google.visualization.arrayToDataTable([
          ['Blood pressure', 'Procentage'],
          ['Low', l*100/21],
          ['Normal', n*100/21],
          ['High', h*100/21]
        ]);    

        var options = {
          title: 'Weekly Data for Blood Pressure',
        };

        var chart = new google.visualization.PieChart(document.getElementById('Weekly_BP'));

        chart.draw(data, options);
    }

    // MONTHLY STATISTICS
    function drawChartMonthPulse() {
        var l = 0, n = 0, h = 0;
        for(var i = 0; i < 30; i++) { 
            l += dailyPulse[i][0];
            n += dailyPulse[i][1];
            h += dailyPulse[i][2];
        } 

        var data = google.visualization.arrayToDataTable([
          ['Pulse', 'Procentage'],
          ['Low', l*100/30],
          ['Normal', n*100/30],
          ['High', h*100/30]
        ]);    

        var options = {
          title: 'Monthly Data for Pulse',
        };

        var chart = new google.visualization.PieChart(document.getElementById('Monthly_Pulse'));

        chart.draw(data, options);
    }

    function drawChartMonthBP() {
        var l = 0, n = 0, h = 0;
        for(var i = 0; i < 90; i++) { 
            if(systolic_val[i] < 90 && diastolic_val[i] < 60) {
                // low 
                l++;  
            } else if(systolic_val[i] > 140 && diastolic_val[i] > 90) {
                // high
                h++;
            } else {
                n++;
            }  
        }   

        var data = google.visualization.arrayToDataTable([
          ['Blood pressure', 'Procentage'],
          ['Low', l*100/90],
          ['Normal', n*100/90],
          ['High', h*100/90]
        ]);    

        var options = {
          title: 'Monthly Data for Blood Pressure',
        };

        var chart = new google.visualization.PieChart(document.getElementById('Monthly_BP'));

        chart.draw(data, options);
    }

    /**
     ALARM SYSTEM
     **/

    function sendEmail(template) {
        console.log("email");
        emailjs.send("gmail",template,{name: "9382665312", notes: "Check this out!"})
            .then(function(response) {
                console.log("SUCCESS. status=%d, text=%s", response.status, response.text);
            }, function(err) {
                console.log("FAILED. error=", err);
            });
    }

    function warnTheDoc(days) {
        var high_blood_pressure = 0;
        var low_blood_pressure = 0;
        var data_for_one_month = 93;
        for(var i = 0; i < data_for_one_month; ++i) {
            for(var j = 0; j < 3; j++) {

                if (systolic_val[i+j] > 140 && diastolic_val[i+j] > 90 && pulse_rate_val[i+j] > 100) {
                    console.log("high");
                    high_blood_pressure++;
                    break;
                } else if (systolic_val[i+j] < 90 && diastolic_val[i+j] < 60 && pulse_rate_val[i+j] < 60) {
                    console.log("low");
                    low_blood_pressure++;
                    break;
                }
            }
            if (high_blood_pressure >= days) {
                // send email to the doctor
                // also break
                if (days === 2) {
                    // patient
                    console.log("high blood pressure patient");
                    sendEmail("template_UEzwyHt7");
                }
                else if (days === 4) {
                    // nurse
                    console.log("high blood pressure nurse");
                    sendEmail("template_UEzwyHt7");
                } else if (days === 10) {
                    // doctor
                    console.log("high blood pressure doctor");
                    sendEmail("high_blood_pressure_doctor");
                }
                break;
            }
            if (low_blood_pressure >= days) {
                // send email to the doctor
                // also break
                if (days === 2) {
                    // patient
                    console.log("low blood pressure patient");
                    sendEmail("template_UEzwyHt7");
                }
                else if (days === 4) {
                    // nurse
                    console.log("low blood pressure nurse");
                    sendEmail("template_UEzwyHt7");
                } else if (days === 10) {
                    // doctor
                    console.log("low blood pressure doctor");
                    sendEmail("low_blood_pressure_doctor");
                }
                break;
            }
        }

    }

    // warn the patient
    warnTheDoc(2);
    // warn the nurse
    warnTheDoc(4);
    // warn the doctor
    warnTheDoc(10);

	/* CHAT BOOT */
    var headID = document.getElementsByTagName("head")[0];
    var newCss = document.createElement('link');
    newCss.rel = 'stylesheet';
    newCss.type = 'text/css';
    window._botUsername = '630143';
    window._botName = 'WarnADoc';
    newCss.href = "http://rebot.me/assets/css/bot.css";
    var newScript = document.createElement('script');
    newScript.src = "http://rebot.me/assets/js/bot.js";
    newScript.type = 'text/javascript';
    headID.appendChild(newScript);
    headID.appendChild(newCss);
    //$("#answer").find("img").attr("src", "picture/icon_white@1x.png");

</script>